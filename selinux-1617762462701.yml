---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# SELinux
# https://cloud.redhat.com/insights/remediations/1db094e7-140a-4f81-b226-47b6d6b25488
# Generated by Red Hat Insights on Wed, 07 Apr 2021 02:27:42 GMT
# Created by rhn-gps-smikkili

# Kernel panic might occur when using the SELINUX&#x3D;disabled option in the &#x2F;etc&#x2F;selinux&#x2F;config
# Identifier: (advisor:selinux_disabled_kernel_panic|SELINUX_DISABLED_KERNEL_PANIC,boot_cmdline)
# Version: 79af563052ab0187e75cc71cda1479d2cf9d6512
- name: Disable SELinux by adding the selinux=0 parameter to the kernel command line
  hosts: "s4hana-zh896.example.com"
  become: true

  tasks:
    - name: Add selinux=0 to kernel command line
      command: grubby --update-kernel=ALL --args="selinux=0"
      register: grub_change
      changed_when: grub_change.rc == 0

    - when: grub_change is changed
      name: set reboot fact
      set_fact:
        insights_needs_reboot: True


# Automatic system reboot was suppressed for this playbook.
# This play lists the systems that need to be rebooted manually for the changes to take effect.
- name: Reboot reminder
  hosts: "s4hana-zh896.example.com"
  vars:
    insights_signature_exclude: "/hosts"
  gather_facts: False
  tasks:
    - debug:
        msg: "Automatic system reboot was suppressed for this playbook. Reboot {{inventory_hostname}} manually for the changes to take effect."
      when:
        - insights_needs_reboot is defined
        - insights_needs_reboot

- name: run insights
  hosts: "s4hana-zh896.example.com"
  vars:
    insights_signature_exclude: "/hosts"
  become: True
  gather_facts: False
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false